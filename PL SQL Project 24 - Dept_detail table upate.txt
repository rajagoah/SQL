
/*DEPARTMENT TABLE  --> DEPARTMENT_ID / NAME / LOCATION 
  EMPLOYEE TABLE    --> DEPARTMENT_ID / SALARY / EMPLOYEE_ID */

--QUERY THAT WILL BE USED IN PL/SQL
SELECT
COALESCE(B.DEPARTMENT_ID,0) AS DEPARTMENT_ID
, COALESCE(B.NAME,'EXEC') AS DEPARTMENT_NAME
, COUNT(EMPLOYEE_ID) AS EMPS_PER_DEP
, SUM(SALARY) AS SUMSAL_PER_DEP
, CURRENT_TIMESTAMP AS LAST_LOAD_TS
FROM EMPLOYEE A
LEFT OUTER JOIN DEPARTMENT B
ON A.DEPARTMENT_ID = B.DEPARTMENT_ID
GROUP BY B.DEPARTMENT_ID, B.NAME;

--CREATING TARGET TABLE WITH ABOVE QUERY STRUCTURE
CREATE TABLE DEPT_DETAIL
( DEPARTMENT_ID NUMBER NOT NULL
, DEPARTMENT_NAME VARCHAR(20) NOT NULL
, EMPS_PER_DEP NUMBER
, SUMSAL_PER_DEP NUMBER
, LAST_LOAD_TS TIMESTAMP NOT NULL
, CONSTRAINT DEPT_DETAIL_PK PRIMARY KEY (DEPARTMENT_ID));
