--creating a new table to store the max salary aggregated across departments
CREATE TABLE EMP_SAL_MAX
(DEPARMTNET CHAR(3),
 MAX_SALARY NUMBER);

--delete command to delete all records from the table, if there are any
DELETE EMP_SAL_MAX;

--declare block to declare cursor and variable to store the data from the cursor
DECLARE
    CURSOR C1 IS
    SELECT 
    COALESCE(CAST(DEPARTMENT_ID AS CHAR(3)),'CEO') AS DEPARTMENT
    , MAX(SALARY) AS MAX_SAL 
    FROM EMPLOYEE
    GROUP BY DEPARTMENT_ID
    ORDER BY DEPARTMENT_ID ASC;
    
    V_ROW C1%ROWTYPE;

--begin block where the data from the cursor is inserted into the table
BEGIN
    OPEN C1;
    LOOP
        FETCH C1 INTO V_ROW;
        EXIT WHEN C1%NOTFOUND;
        BEGIN
            INSERT INTO EMP_SAL_MAX VALUES
            (V_ROW.DEPARTMENT,
             V_ROW.MAX_SAL);
        END;
        DBMS_OUTPUT.PUT_LINE('ROW INSERTED SUCCESSFULLY!!');
    END LOOP;
END;

--reading the data inserted in to the table
SELECT * FROM EMP_SAL_MAX;

            